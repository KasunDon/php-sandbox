var SANDBOX={};SANDBOX.validation={},SANDBOX.utils={},SANDBOX.core={},SANDBOX.core.content={},SANDBOX.core.editor=null,SANDBOX.core.defaultCode=null,SANDBOX.core.theme="xcode",SANDBOX.core.viewId=null,SANDBOX.core.viewLink=null,SANDBOX.core.create_time=null,SANDBOX.core.version=null,SANDBOX.core.output=null,SANDBOX.core.views=null,SANDBOX.core.shareMode=0,SANDBOX.core.selectors={"version-selector":{},"theme-selector":{noneSelectedText:"Theme",size:"auto"}},SANDBOX.utils.load=function(){if($("#view-code").length){var e=JSON.parse($("#view-code").val());SANDBOX.core.viewId=e.id,SANDBOX.core.viewLink=e.view_link+e.id,SANDBOX.core.create_time=e.create_time,SANDBOX.core.version=e.version,SANDBOX.core.views=e.views,SANDBOX.core.shareMode=1,SANDBOX.core.output=$("#output").text(),SANDBOX.core.theme=e.theme,SANDBOX.core.editor=SANDBOX.utils.initEditor(SANDBOX.core.theme),$("#run-datetime").html("<span class='glyphicon glyphicon-time'></span> "+SANDBOX.core.create_time),$("#output-zone").show(),$("#php-version").text($("#php-version").text()+SANDBOX.core.version),$("#views").text(SANDBOX.core.views),$("#view-link").text(SANDBOX.core.viewLink),$("#view-link").attr("href",SANDBOX.core.viewLink),$("#view-link-zone").show()}},SANDBOX.utils.showEmbed=function(){$.get("/get-embed/"+SANDBOX.core.viewId,function(e){$("#embed-output").html(e),$("#modal-embed").html(e)})},SANDBOX.utils.getSelection=function(e){return $(e).find(":selected").val()},SANDBOX.core.serviceView=function(e){$(e).on("click",function(e){bootbox.dialog({message:SANDBOX.core.content.serviceContent,title:"<span class='glyphicon glyphicon-wrench' style='padding-left:5px;'></span> Service Status",buttons:{close:{label:"Close",className:"btn-default",callback:function(){}}}})})},SANDBOX.core.socialTab=function(){SANDBOX.core.viewId==null||SANDBOX.core.shareMode===2?($("#progress").show(),setTimeout(function(){var e=$("#theme-selector").find(":selected").val()||"xcode";$.post("/save-code",{code:SANDBOX.core.editor.getValue(),output:SANDBOX.core.output,create_time:SANDBOX.core.create_time,version:SANDBOX.core.version,theme:e,vType:"c1"},function(e){SANDBOX.core.viewId=e.viewId,SANDBOX.core.viewLink=e.viewLink+e.viewId,SANDBOX.utils.showEmbed(),$("#view-link").text(SANDBOX.core.viewLink),$("#view-link").attr("href",SANDBOX.core.viewLink),$("#view-link-zone").show(),$("#progress").hide(),$("#modal-view-link-zone").show(),$("#modal-view-link").text(SANDBOX.core.viewLink),$("#modal-view-link").attr("href",SANDBOX.core.viewLink),$("#social-zone").share({networks:["facebook","pinterest","googleplus","twitter","linkedin","tumblr","in1","email","stumbleupon","digg"],urlToShare:SANDBOX.core.viewLink}),$("#social-links").show()}).fail(function(){$("#progress").hide(),SANDBOX.utils.closeModal(4e3),$("#social-error").show()})},2e3)):($("#modal-view-link-zone").show(),$("#modal-view-link").text(SANDBOX.core.viewLink),$("#modal-view-link").attr("href",SANDBOX.core.viewLink),$("#social-zone").share({networks:["facebook","pinterest","googleplus","twitter","linkedin","tumblr","in1","email","stumbleupon","digg"],urlToShare:SANDBOX.core.viewLink}),$("#social-links").show())},SANDBOX.core.getTheme=function(){$.post("/theme-settings",{theme:SANDBOX.core.theme},function(e){SANDBOX.core.theme=e.theme,SANDBOX.core.editor=SANDBOX.utils.initEditor(SANDBOX.core.theme),SANDBOX.core.selectTheme()})},SANDBOX.core.run=function(){$("#run").on("click",function(){var e=SANDBOX.utils.getSelection("#version-selector");if(e==null)return alert("Please select PHP runtime version"),!1;if(SANDBOX.core.shareMode===0&&SANDBOX.core.defaultCode===SANDBOX.core.editor.getValue())return alert("Code editor hasn't changed. Assume there are no code to be run"),!1;$("#loading").show(),$.post("/api/php/"+e+"/run",{v:e,code:SANDBOX.core.editor.getValue()},function(e){$("#loading").hide(),$("#output").text(e.output),SANDBOX.core.create_time=e.datetime,SANDBOX.core.output!==e.output&&(SANDBOX.core.shareMode=2),SANDBOX.core.output=e.output,SANDBOX.core.version=$("#version-selector option:selected").val(),$("#run-datetime").html("<span class='glyphicon glyphicon-time'></span> "+SANDBOX.core.create_time),$("#output-zone").show(),$("#php-version").text(SANDBOX.core.version),$("html, body").animate({scrollTop:$("#output-zone").offset().top},"slow")})})},SANDBOX.core.selectTheme=function(){$("#theme-selector").val(SANDBOX.core.theme)},SANDBOX.core.setTheme=function(){$.get("/theme-settings",{clear:!0},function(){return SANDBOX.core.getTheme()})},SANDBOX.utils.viewLoader=function(e,t,n,r){var i=r||!1,s=function(e,t,n){$.get(e,t,function(e){SANDBOX.core.content[n]=e})};s(e,t,n),i!==!1&&setInterval(function(){s(e,t,n)},i)},SANDBOX.core.setup=function(){$.ajaxSetup({headers:{"X-CSRF-Token":$('meta[name="_token"]').attr("content")}});for(var e in SANDBOX.core.selectors)$("#"+e).selectpicker(SANDBOX.core.selectors[e]);SANDBOX.core.editor=SANDBOX.utils.initEditor(SANDBOX.core.theme),SANDBOX.core.defaultCode=SANDBOX.core.editor.getValue(),SANDBOX.utils.viewLoader("/view-service",{},"serviceContent",6e4),SANDBOX.utils.viewLoader("/view-report-issue",{},"reportContent"),SANDBOX.utils.viewLoader("/view-feedback",{},"feedbackContent"),SANDBOX.utils.viewLoader("/view-social",{},"socialContent"),SANDBOX.utils.viewLoader("/view-terms",{},"termsContent"),$("#theme-selector").change(function(){SANDBOX.core.theme=SANDBOX.utils.getSelection(this),SANDBOX.core.setTheme()}),SANDBOX.core.run(),SANDBOX.utils.load(),SANDBOX.core.shareMode!==1&&SANDBOX.core.getTheme(),$("#report").on("click",function(e){bootbox.dialog({message:SANDBOX.core.content.reportContent,title:"<span class='glyphicon glyphicon-exclamation-sign' style='padding-left:5px;'></span> Report a issue",buttons:{report:{label:"Report",className:"btn-danger",callback:function(){return $("#report-form").trigger("submit"),!1}},close:{label:"Close",className:"btn-default",callback:function(){}}}})}),$("#feedback").on("click",function(e){bootbox.dialog({message:SANDBOX.core.content.feedbackContent,title:"<span class='glyphicon glyphicon-hand-up' style='padding-left:5px;'></span> Send Feedback",buttons:{feedback:{label:"Send",className:"btn-success",callback:function(){return $("#feedback-form").trigger("submit"),!1}},close:{label:"Close",className:"btn-default",callback:function(){}}}})}),SANDBOX.core.serviceView("#service"),$("#save_share").on("click",function(){var e="<span class='glyphicon glyphicon-globe' style='padding-left:5px;'></span> Save & Share";SANDBOX.core.viewId!==null&&(e="<span class='glyphicon glyphicon-globe' style='padding-left:5px;'></span> Share"),bootbox.dialog({message:SANDBOX.core.content.socialContent,title:e,buttons:{close:{label:"Close",className:"btn-default",callback:function(){}}}}),SANDBOX.core.viewId!==null&&SANDBOX.utils.showEmbed()}),$("#terms").on("click",function(e){bootbox.dialog({message:SANDBOX.core.content.termsContent,title:"<span class='glyphicon glyphicon-th-list' style='padding-left:5px;'></span> Terms & Conditions",buttons:{close:{label:"Close",className:"btn-default",callback:function(){}}}})})},SANDBOX.utils.closeModal=function(e){e=typeof e!="undefined"?e:0,window.setTimeout(function(){bootbox.hideAll()},e)},SANDBOX.validation.issue=function(){$("#report-form").bootstrapValidator({feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{email:{validators:{notEmpty:{message:"The email address is required and cannot be empty"},emailAddress:{message:"The email address is not a valid"}}},subject:{validators:{notEmpty:{message:"The subject cannot be empty"}}}}}).on("success.form.bv",function(e){e.preventDefault(),$.post("/report-issue",{email:$("#report-email").val(),subject:$("#report-subject").val(),issue:$("#report-issue").val(),vType:"t1"},function(){$("button[data-bb-handler='report']").hide(),$("#report-success").show(),$("#report-form").hide(),SANDBOX.utils.closeModal(3e3)}).fail(function(){$("button[data-bb-handler='report']").prop("disabled",!0),$("#report-error").show(),$("#report-form").hide(),SANDBOX.utils.closeModal(5e3)})})},SANDBOX.utils.initEditor=function(e){var t=ace.edit("editor");return t.setTheme("ace/theme/"+e),t.getSession().setMode("ace/mode/php"),t},SANDBOX.validation.feedback=function(){$("#feedback-form").bootstrapValidator({feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{feedback:{validators:{notEmpty:{message:"Feedback cannot be empty"}}}}}).on("success.form.bv",function(e){e.preventDefault(),$.post("/send-feedback",{feedback:$("#feedback-message").val(),vType:"f1"},function(){$("button[data-bb-handler='feedback']").hide(),$("#feedback-success").show(),$("#feedback-form").hide(),SANDBOX.utils.closeModal(3e3)}).fail(function(){$("button[data-bb-handler='feedback']").prop("disabled",!0),$("#feedback-error").show(),$("#feedback-form").hide(),SANDBOX.utils.closeModal(5e3)})})};