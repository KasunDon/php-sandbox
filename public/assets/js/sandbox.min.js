var SANDBOX={};SANDBOX.validation={};SANDBOX.utils={};SANDBOX.core={};SANDBOX.core.content={};SANDBOX.core.content.tabBackup=[];SANDBOX.core.request=null;SANDBOX.core.editor=null;SANDBOX.core.defaultCode=null;SANDBOX.core.theme="xcode";SANDBOX.core.viewId=null;SANDBOX.core.viewLink=null;SANDBOX.core.create_time=null;SANDBOX.core.version=[];SANDBOX.core.output=null;SANDBOX.core.views=null;SANDBOX.core.shareMode=0;SANDBOX.core.selectors={"version-selector":{},"theme-selector":{noneSelectedText:"Theme",size:"auto"}};SANDBOX.utils.load=function(){if($("#view-code").length){var a=JSON.parse($("#view-code").val());SANDBOX.core.viewId=a.id;SANDBOX.core.viewLink=a.view_link+a.id;SANDBOX.core.create_time=a.create_time;SANDBOX.core.version[1]=a.version;SANDBOX.core.version[0]=a.type;SANDBOX.core.views=a.views;SANDBOX.core.shareMode=1;SANDBOX.core.output=$("#output").text();SANDBOX.core.theme=a.theme||SANDBOX.core.theme;SANDBOX.core.editor=SANDBOX.utils.initEditor(SANDBOX.core.theme);$("#run-datetime").html("<span class='glyphicon glyphicon-time'></span> "+SANDBOX.core.create_time);$("#output-zone").show();$("#code-type").text(SANDBOX.core.version[0]);$("#code-version").text(SANDBOX.core.version[1]);$("#views").text(SANDBOX.core.views);$("#view-link").text(SANDBOX.core.viewLink);$("#view-link").attr("href",SANDBOX.core.viewLink);$("#view-link-zone").show();SANDBOX.core.tabControl(SANDBOX.core.getApiPayload())}};SANDBOX.utils.showEmbed=function(){$.get("/get-embed/"+SANDBOX.core.viewId,function(a){$("#embed-output").html(a);$("#modal-embed").html(a)})};SANDBOX.utils.getSelection=function(a){return $(a).find(":selected").val()};SANDBOX.core.serviceView=function(a){$(a).on("click",function(b){bootbox.dialog({message:SANDBOX.core.content.serviceContent,title:"<span class='glyphicon glyphicon-wrench' style='padding-left:5px;'></span> Service Status",buttons:{close:{label:"Close",className:"btn-default",callback:function(){}}}})})};SANDBOX.core.socialTab=function(){if(SANDBOX.core.viewId==null||SANDBOX.core.shareMode===2){$("#progress").show();setTimeout(function(){var a=$("#theme-selector").find(":selected").val()||"xcode";$.post("/store",{code:SANDBOX.core.editor.getValue(),output:SANDBOX.core.output,create_time:SANDBOX.core.create_time,version:SANDBOX.core.version[1],type:SANDBOX.core.version[0],theme:a,vType:"c1"},function(b){SANDBOX.core.viewId=b.viewId;SANDBOX.core.viewLink=b.viewLink+b.viewId;$("#view-link").text(SANDBOX.core.viewLink);$("#view-link").attr("href",SANDBOX.core.viewLink);$("#view-link-zone").show();$("#progress").hide();$("#modal-view-link-zone").show();$("#modal-view-link").text(SANDBOX.core.viewLink);$("#modal-view-link").attr("href",SANDBOX.core.viewLink);$("#social-zone").share({networks:["facebook","pinterest","googleplus","twitter","linkedin","tumblr","in1","email","stumbleupon","digg"],urlToShare:SANDBOX.core.viewLink,});$("#social-links").show();SANDBOX.utils.showEmbed()}).fail(function(){$("#progress").hide();SANDBOX.utils.closeModal(4000);$("#social-error").show()})},2000)}else{$("#modal-view-link-zone").show();$("#modal-view-link").text(SANDBOX.core.viewLink);$("#modal-view-link").attr("href",SANDBOX.core.viewLink);$("#social-zone").share({networks:["facebook","pinterest","googleplus","twitter","linkedin","tumblr","in1","email","stumbleupon","digg"],urlToShare:SANDBOX.core.viewLink,});$("#social-links").show()}};SANDBOX.core.setSettings=function(){$.post("/usr-slct",{theme:SANDBOX.core.theme,version:SANDBOX.core.version[1],type:SANDBOX.core.version[0]},function(a){SANDBOX.core.theme=a.theme;SANDBOX.core.version[1]=a.version;SANDBOX.core.version[0]=a.type;SANDBOX.core.editor=SANDBOX.utils.initEditor(SANDBOX.core.theme);SANDBOX.core.setUI()})};SANDBOX.core.runUpdate=function(a){$("#run").attr("disabled",a);var c=["#stop","#loading"];for(var d in c){if(a===false){$(c[d]).hide();continue}$(c[d]).show()}};SANDBOX.core.getApiPayload=function(){return{v:SANDBOX.core.version[1],code:SANDBOX.core.editor.getValue()}};SANDBOX.core.disableTabs=function(b){for(var a in b){$("#"+b[a]).removeClass("active").addClass("disabled");var c=$("#"+b[a]+" a").attr("href");SANDBOX.core.content.tabBackup[c]=$(c).html();$(c).html("<i>Option not supported.</i>")}};SANDBOX.core.activateAllTabs=function(){$("#tabs li").each(function(){$(this).removeClass("disabled");$(this).find("a").each(function(){var a=$(this).attr("href");if(typeof SANDBOX.core.content.tabBackup[a]!=="undefined"){$(a).html(SANDBOX.core.content.tabBackup[a])}})})};SANDBOX.core.getRefs=function(a){$.post("/api/code-ref",a,function(d){var c="";for(var b in d.output){c+="<li><a href='"+d.output[b]+"' style='cursor: help;'>"+b+"</a></li>"}if(c===""){c="<li><b>No Internal method references found.</b></li>"}$("#ref-list").html(c)})};SANDBOX.core.getVLD=function(a){$.post("/api/vld-data",a,function(c){var b="";b=c.output;if(b===""){b="<li><b>No VLD data available.</b></li>"}$("#vld-data").html(b)})};SANDBOX.core.run=function(){$("#stop").on("click",function(){SANDBOX.core.request.abort();SANDBOX.core.runUpdate(false)});$("#run").on("click",function(){SANDBOX.core.version=SANDBOX.utils.getSelection("#version-selector");SANDBOX.core.version=SANDBOX.core.version.split(" ");SANDBOX.core.runUpdate(true);var a=SANDBOX.core.getApiPayload();SANDBOX.core.request=$.post("/api/"+SANDBOX.core.version[0].toLowerCase()+"/"+SANDBOX.core.version[1],a,function(b){SANDBOX.core.runUpdate(false);$("#output").text(b.output);SANDBOX.core.create_time=b.datetime;if(SANDBOX.core.output!==b.output){SANDBOX.core.shareMode=2}SANDBOX.core.output=b.output;$("#run-datetime").html("<span class='glyphicon glyphicon-time'></span> "+SANDBOX.core.create_time);$("#output-zone").show();$("#code-type").text(SANDBOX.core.version[0]);$("#code-version").text(SANDBOX.core.version[1]);$("html, body").animate({scrollTop:$("#output-zone").offset().top},"slow")});SANDBOX.core.tabControl(a)})};SANDBOX.core.tabControl=function(a){if(SANDBOX.core.version[0].toLowerCase()==="php"){SANDBOX.core.activateAllTabs();SANDBOX.core.getRefs(a);SANDBOX.core.getVLD(a)}else{SANDBOX.core.disableTabs(["ref","vld"])}SANDBOX.core.tabAutoFocus()};SANDBOX.core.tabAutoFocus=function(){$("#tabs li").each(function(){var a=$(this).attr("class");if(a!=="disabled"){$(this).find("a").each(function(){$(this).tab("show")});return false}})};SANDBOX.core.setUI=function(){$("#theme-selector").val(SANDBOX.core.theme);$("#version-selector").val(SANDBOX.core.version[0]+" "+SANDBOX.core.version[1]);$(".selectpicker").selectpicker("refresh")};SANDBOX.core.clearSettings=function(){$.get("/usr-slct",{clear:true},function(){return SANDBOX.core.setSettings()})};SANDBOX.utils.viewLoader=function(c,d,b,a){var e=a||false;var f=function(h,i,g){$.get(h,i,function(j){SANDBOX.core.content[g]=j})};f(c,d,b);if(e!==false){setInterval(function(){f(c,d,b)},(e))}};SANDBOX.core.setup=function(){$.ajaxSetup({headers:{"X-CSRF-Token":$('meta[name="_token"]').attr("content")}});for(var a in SANDBOX.core.selectors){$("#"+a).selectpicker(SANDBOX.core.selectors[a])}$('a[data-toggle="tab"]').on("click",function(){if($(this).parent("li").hasClass("disabled")){return false}});SANDBOX.core.editor=SANDBOX.utils.initEditor(SANDBOX.core.theme);SANDBOX.core.defaultCode=SANDBOX.core.editor.getValue();SANDBOX.utils.viewLoader("/view-service",{},"serviceContent");SANDBOX.utils.viewLoader("/view-report-issue",{},"reportContent");SANDBOX.utils.viewLoader("/view-feedback",{},"feedbackContent");SANDBOX.utils.viewLoader("/view-social",{},"socialContent");SANDBOX.utils.viewLoader("/view-terms",{},"termsContent");$("#theme-selector, #version-selector").change(function(){SANDBOX.core.theme=SANDBOX.utils.getSelection("#theme-selector")||SANDBOX.core.theme;SANDBOX.core.version=SANDBOX.utils.getSelection("#version-selector");SANDBOX.core.version=SANDBOX.core.version.split(" ");SANDBOX.core.clearSettings()});SANDBOX.core.run();SANDBOX.utils.load();if(SANDBOX.core.shareMode!==1){SANDBOX.core.setSettings()}$("#report").on("click",function(b){bootbox.dialog({message:SANDBOX.core.content.reportContent,title:"<span class='glyphicon glyphicon-exclamation-sign' style='padding-left:5px;'></span> Report a issue",buttons:{report:{label:"Report",className:"btn-danger",callback:function(){$("#report-form").trigger("submit");return false}},close:{label:"Close",className:"btn-default",callback:function(){}}}})});$("#feedback").on("click",function(b){bootbox.dialog({message:SANDBOX.core.content.feedbackContent,title:"<span class='glyphicon glyphicon-hand-up' style='padding-left:5px;'></span> Send Feedback",buttons:{feedback:{label:"Send",className:"btn-success",callback:function(){$("#feedback-form").trigger("submit");return false}},close:{label:"Close",className:"btn-default",callback:function(){}}}})});SANDBOX.core.serviceView("#service");$("#save_share").on("click",function(){var b="<span class='glyphicon glyphicon-globe' style='padding-left:5px;'></span> Save & Share";if(SANDBOX.core.viewId!==null){b="<span class='glyphicon glyphicon-globe' style='padding-left:5px;'></span> Share"}bootbox.dialog({message:SANDBOX.core.content.socialContent,title:b,buttons:{close:{label:"Close",className:"btn-default",callback:function(){}}}});if(SANDBOX.core.viewId!==null){SANDBOX.utils.showEmbed()}});$("#terms").on("click",function(b){bootbox.dialog({message:SANDBOX.core.content.termsContent,title:"<span class='glyphicon glyphicon-th-list' style='padding-left:5px;'></span> Terms & Conditions",buttons:{close:{label:"Close",className:"btn-default",callback:function(){}}}})})};SANDBOX.utils.closeModal=function(a){a=typeof a!=="undefined"?a:0;window.setTimeout(function(){bootbox.hideAll()},a)};SANDBOX.validation.issue=function(){$("#report-form").bootstrapValidator({feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{email:{validators:{notEmpty:{message:"The email address is required and cannot be empty"},emailAddress:{message:"The email address is not a valid"}}},subject:{validators:{notEmpty:{message:"The subject cannot be empty"}}}}}).on("success.form.bv",function(a){a.preventDefault();$.post("/report-issue",{email:$("#report-email").val(),subject:$("#report-subject").val(),issue:$("#report-issue").val(),vType:"t1"},function(){$("button[data-bb-handler='report']").hide();$("#report-success").show();$("#report-form").hide();SANDBOX.utils.closeModal(3000)}).fail(function(){$("button[data-bb-handler='report']").prop("disabled",true);$("#report-error").show();$("#report-form").hide();SANDBOX.utils.closeModal(5000)})})};SANDBOX.utils.initEditor=function(a){ace.require("ace/ext/language_tools");var b=ace.edit("editor");b.setTheme("ace/theme/"+a);b.getSession().setMode("ace/mode/php");b.setOptions({enableBasicAutocompletion:true,enableSnippets:true,enableLiveAutocompletion:false});return b};SANDBOX.validation.feedback=function(){$("#feedback-form").bootstrapValidator({feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{feedback:{validators:{notEmpty:{message:"Feedback cannot be empty"}}}}}).on("success.form.bv",function(a){a.preventDefault();$.post("/send-feedback",{feedback:$("#feedback-message").val(),vType:"f1"},function(){$("button[data-bb-handler='feedback']").hide();$("#feedback-success").show();$("#feedback-form").hide();SANDBOX.utils.closeModal(3000)}).fail(function(){$("button[data-bb-handler='feedback']").prop("disabled",true);$("#feedback-error").show();$("#feedback-form").hide();SANDBOX.utils.closeModal(5000)})})};