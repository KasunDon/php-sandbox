var SANDBOX={};SANDBOX.validation={};SANDBOX.utils={};SANDBOX.core={};SANDBOX.core.content={};SANDBOX.core.defaultCode=null;SANDBOX.core.viewId=null;SANDBOX.core.viewLink=null;SANDBOX.core.create_time=null;SANDBOX.core.version=null;SANDBOX.core.output=null;SANDBOX.core.views=null;SANDBOX.core.content.reportContent=null;SANDBOX.core.content.feedbackContent=null;SANDBOX.core.content.serviceContent=null;SANDBOX.core.content.socialContent=null;SANDBOX.core.content.termsContent=null;SANDBOX.utils.loadData=function(){if($("#view-code").length){var a=JSON.parse($("#view-code").val());SANDBOX.core.viewId=a.id;SANDBOX.core.viewLink=a.view_link+a.id;SANDBOX.core.create_time=a.create_time;SANDBOX.core.version=a.version;SANDBOX.core.views=a.views;$("#run-datetime").html("<span class='glyphicon glyphicon-time'></span> "+SANDBOX.core.create_time);$("#output-zone").show();$("#php-version").text($("#php-version").text()+SANDBOX.core.version);$("#views").text(SANDBOX.core.views);$("#view-link").text(SANDBOX.core.viewLink);$("#view-link").attr("href",SANDBOX.core.viewLink);$("#view-link-zone").show()}};SANDBOX.core.serviceView=function(a){$(a).on("click",function(b){bootbox.dialog({message:SANDBOX.core.content.serviceContent,title:"<span class='glyphicon glyphicon-wrench' style='padding-left:5px;'></span> Service Status",buttons:{close:{label:"Close",className:"btn-default",callback:function(){}}}})})};SANDBOX.core.socialTab=function(){var a=ace.edit("editor");if(SANDBOX.core.viewId==null){$("#progress").show();setTimeout(function(){$.post("/save-code",{code:a.getValue(),output:SANDBOX.core.output,create_time:SANDBOX.core.create_time,version:SANDBOX.core.version,vType:"c1"},function(b){SANDBOX.core.viewId=b.viewId;SANDBOX.core.viewLink=b.viewLink+b.viewId;$("#view-link").text(SANDBOX.core.viewLink);$("#view-link").attr("href",SANDBOX.core.viewLink);$("#view-link-zone").show();$("#progress").hide();$("#modal-view-link-zone").show();$("#modal-view-link").text(SANDBOX.core.viewLink);$("#modal-view-link").attr("href",SANDBOX.core.viewLink);$("#social-zone").share({networks:["facebook","pinterest","googleplus","twitter","linkedin","tumblr","in1","email","stumbleupon","digg"],urlToShare:SANDBOX.core.viewLink,});$("#social-links").show()}).fail(function(){$("#progress").hide();SANDBOX.utils.closeModal(4000);$("#social-error").show()})},2000)}else{$("#modal-view-link-zone").show();$("#modal-view-link").text(SANDBOX.core.viewLink);$("#modal-view-link").attr("href",SANDBOX.core.viewLink);$("#social-zone").share({networks:["facebook","pinterest","googleplus","twitter","linkedin","tumblr","in1","email","stumbleupon","digg"],urlToShare:SANDBOX.core.viewLink,});$("#social-links").show()}};SANDBOX.core.setup=function(){var a=SANDBOX.utils.initEditor();SANDBOX.core.defaultCode=a.getValue();$(".selectpicker").selectpicker();$("#run").on("click",function(){var b=null;b=$(".selectpicker").find(":selected").val();if(b==null){alert("Please select PHP runtime version");return false}if(SANDBOX.core.defaultCode===a.getValue()){alert("Code editor hasn't changed. Assume there are no code to be run");return false}$("#loading").show();$.post("/api/php/"+b+"/run",{v:b,code:a.getValue()},function(c){$("#loading").hide();$("#output").text(c.output);SANDBOX.core.create_time=c.datetime;SANDBOX.core.output=c.output;SANDBOX.core.version=$("#version-selector option:selected").val();$("#run-datetime").html("<span class='glyphicon glyphicon-time'></span> "+SANDBOX.core.create_time);$("#output-zone").show();$("#php-version").text(SANDBOX.core.version);$("html, body").animate({scrollTop:$("#output-zone").offset().top},"slow")})});$.get("/view-report-issue",function(b){SANDBOX.core.content.reportContent=b});$.get("/view-feedback",function(b){SANDBOX.core.content.feedbackContent=b});$.get("/view-service",function(b){SANDBOX.core.content.serviceContent=b});$.get("/view-social",function(b){SANDBOX.core.content.socialContent=b});$.get("/view-terms",function(b){SANDBOX.core.content.termsContent=b});setInterval(function(){$.get("/view-service",function(b){SANDBOX.core.content.serviceContent=b})},(600000));SANDBOX.utils.loadData();$("#report").on("click",function(b){bootbox.dialog({message:SANDBOX.core.content.reportContent,title:"<span class='glyphicon glyphicon-exclamation-sign' style='padding-left:5px;'></span> Report a issue",buttons:{report:{label:"Report",className:"btn-danger",callback:function(){$("#report-form").trigger("submit");return false}},close:{label:"Close",className:"btn-default",callback:function(){}}}})});$("#feedback").on("click",function(b){bootbox.dialog({message:SANDBOX.core.content.feedbackContent,title:"<span class='glyphicon glyphicon-hand-up' style='padding-left:5px;'></span> Send Feedback",buttons:{feedback:{label:"Send",className:"btn-success",callback:function(){$("#feedback-form").trigger("submit");return false}},close:{label:"Close",className:"btn-default",callback:function(){}}}})});SANDBOX.core.serviceView("#service");$("#save_share").on("click",function(){var b="<span class='glyphicon glyphicon-globe' style='padding-left:5px;'></span> Save & Share";if(SANDBOX.core.viewId!=null){b="<span class='glyphicon glyphicon-globe' style='padding-left:5px;'></span> Share"}bootbox.dialog({message:SANDBOX.core.content.socialContent,title:b,buttons:{close:{label:"Close",className:"btn-default",callback:function(){}}}})});$("#terms").on("click",function(b){bootbox.dialog({message:SANDBOX.core.content.termsContent,title:"<span class='glyphicon glyphicon-th-list' style='padding-left:5px;'></span> Terms & Conditions",buttons:{close:{label:"Close",className:"btn-default",callback:function(){}}}})})};SANDBOX.utils.closeModal=function(a){a=typeof a!=="undefined"?a:0;window.setTimeout(function(){bootbox.hideAll()},a)};SANDBOX.validation.issue=function(){$("#report-form").bootstrapValidator({feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{email:{validators:{notEmpty:{message:"The email address is required and cannot be empty"},emailAddress:{message:"The email address is not a valid"}}},subject:{validators:{notEmpty:{message:"The subject cannot be empty"}}}}}).on("success.form.bv",function(a){a.preventDefault();$.post("/report-issue",{email:$("#report-email").val(),subject:$("#report-subject").val(),issue:$("#report-issue").val(),vType:"t1"},function(){$("button[data-bb-handler='report']").hide();$("#report-success").show();$("#report-form").hide();SANDBOX.utils.closeModal(3000)}).fail(function(){$("button[data-bb-handler='report']").prop("disabled",true);$("#report-error").show();$("#report-form").hide();SANDBOX.utils.closeModal(5000)})})};SANDBOX.utils.initEditor=function(){var a=ace.edit("editor");a.setTheme("ace/theme/xcode");a.getSession().setMode("ace/mode/php");return a};SANDBOX.validation.feedback=function(){$("#feedback-form").bootstrapValidator({feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{feedback:{validators:{notEmpty:{message:"Feedback cannot be empty"}}}}}).on("success.form.bv",function(a){a.preventDefault();$.post("/send-feedback",{feedback:$("#feedback-message").val(),vType:"f1"},function(){$("button[data-bb-handler='feedback']").hide();$("#feedback-success").show();$("#feedback-form").hide();SANDBOX.utils.closeModal(3000)}).fail(function(){$("button[data-bb-handler='feedback']").prop("disabled",true);$("#feedback-error").show();$("#feedback-form").hide();SANDBOX.utils.closeModal(5000)})})};